From cd51a8b7b961cc7f1ed22109aeeed5f9a045e927 Mon Sep 17 00:00:00 2001
From: Alfred Wingate <parona@protonmail.com>
Date: Sat, 9 Jul 2022 12:32:46 +0300
Subject: [PATCH] Add config version cmake file for lld

---
 lld/cmake/modules/CMakeLists.txt            | 9 +++++++++
 lld/cmake/modules/LLDConfigVersion.cmake.in | 6 ++++++
 2 files changed, 15 insertions(+)
 create mode 100644 lld/cmake/modules/LLDConfigVersion.cmake.in

diff --git a/lld/cmake/modules/CMakeLists.txt b/lld/cmake/modules/CMakeLists.txt
index 760c9d5f8d..3d9f0fc7ee 100644
--- a/lld/cmake/modules/CMakeLists.txt
+++ b/lld/cmake/modules/CMakeLists.txt
@@ -26,6 +26,10 @@ configure_file(
   ${CMAKE_CURRENT_SOURCE_DIR}/LLDConfig.cmake.in
   ${lld_cmake_builddir}/LLDConfig.cmake
   @ONLY)
+configure_file(
+  ${CMAKE_CURRENT_SOURCE_DIR}/LLDConfigVersion.cmake.in
+  ${lld_cmake_builddir}/LLDConfigVersion.cmake
+  @ONLY)
 set(LLD_CONFIG_CMAKE_DIR)
 set(LLD_CONFIG_LLVM_CMAKE_DIR)
 
@@ -39,6 +43,10 @@ configure_file(
   ${CMAKE_CURRENT_SOURCE_DIR}/LLDConfig.cmake.in
   ${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/LLDConfig.cmake
   @ONLY)
+configure_file(
+  ${CMAKE_CURRENT_SOURCE_DIR}/LLDConfigVersion.cmake.in
+  ${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/LLDConfigVersion.cmake
+  @ONLY)
 set(LLD_CONFIG_CODE)
 set(LLD_CONFIG_CMAKE_DIR)
 
@@ -47,6 +55,7 @@ if (NOT LLVM_INSTALL_TOOLCHAIN_ONLY)
 
   install(FILES
     ${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/LLDConfig.cmake
+    ${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/LLDConfigVersion.cmake
     DESTINATION ${LLD_INSTALL_PACKAGE_DIR}
     COMPONENT lld-cmake-exports)
 
diff --git a/lld/cmake/modules/LLDConfigVersion.cmake.in b/lld/cmake/modules/LLDConfigVersion.cmake.in
new file mode 100644
index 0000000000..829eeaa1b9
--- /dev/null
+++ b/lld/cmake/modules/LLDConfigVersion.cmake.in
@@ -0,0 +1,6 @@
+set(PACKAGE_VERSION "@PACKAGE_VERSION@")
+
+if("@LLD_VERSION_MAJOR@" VERSION_EQUAL
+    "${PACKAGE_FIND_VERSION_MAJOR}")
+  set(PACKAGE_VERSION_COMPATIBLE 1)
+endif()
-- 
2.35.1


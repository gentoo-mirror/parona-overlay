From a77741266285df1ad2f88717b0dca596d6245fdd Mon Sep 17 00:00:00 2001
From: Alfred Wingate <parona@protonmail.com>
Date: Fri, 1 Jul 2022 10:05:08 +0300
Subject: [PATCH] CMakeLists.txt: Allow feeding OM_VERSION info

---
 CMakeLists.txt | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 28b5030a..5515df3b 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -275,21 +275,27 @@ if (USE_PCH)
 endif()
 
 # Generate version header file.
+if (NOT OM_VERSION)
 execute_process(COMMAND tools/unix/version.sh android_name
   WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
   OUTPUT_VARIABLE OM_VERSION
   OUTPUT_STRIP_TRAILING_WHITESPACE
 )
+endif()
+if (NOT OM_VERSION_CODE)
 execute_process(COMMAND tools/unix/version.sh android_code
   WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
   OUTPUT_VARIABLE OM_VERSION_CODE
   OUTPUT_STRIP_TRAILING_WHITESPACE
 )
+endif()
+if (NOT OM_GIT_HASH)
 execute_process(COMMAND tools/unix/version.sh git_hash
   WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
   OUTPUT_VARIABLE OM_GIT_HASH
   OUTPUT_STRIP_TRAILING_WHITESPACE
 )
+endif()
 # TODO: Does it run on every build or only on configure step?
 # TODO: Run only when dependent targets are built.
 configure_file(build_version.hpp.in ${CMAKE_SOURCE_DIR}/build_version.hpp @ONLY)
-- 
2.35.1

